# SillyTavern控制台功能详细实现需求 - Requirements Confirmation

## 原始需求总结
澄清并细化SillyTavern控制台的4个核心功能的具体实现方式，包括配置管理、实时日志查看、数据管理和Docker版本信息显示。

## 需求澄清过程

### 功能1: 配置管理 - 在线修改用户名密码
**实现方式确认**:
- **表单验证**: 用户名不能包含数字，需要前端和后端双重验证
- **生效机制**: 修改后必须立即重启容器才能生效
- **用户提示**: 显示"配置已修改，正在重启容器..."的进度提示
- **操作流程**: 修改config.yaml → 验证格式 → 重启容器 → 验证启动成功
- **错误处理**: 配置文件格式错误时回滚到备份版本，容器启动失败时提供回滚选项

### 功能2: 实时日志查看 - tail -f模式实现
**实现方式确认**:
- **日志条数选择**: 支持500条、1000条、3000条三个选项
- **实时更新**: 使用WebSocket推送日志更新到前端
- **内存管理**: 后端不存储日志历史，前端负责内存管理和滚动显示
- **自动滚动**: 日志自动滚动到最新内容
- **连接管理**: 用户断开连接后自动停止后端的tail -f进程
- **不支持功能**: 明确不需要日志搜索/关键词过滤功能

### 功能3: 数据管理 - 基于SFTP的导入导出
**实现方式确认**:
- **导出范围**: 导出docker-compose.yaml中映射的./data目录（已映射到宿主机）
- **存储位置**: ZIP文件存储在docker-compose容器的根目录(/data/docker/sillytavem/)
- **导出流程**: 不需要停止容器 → 压缩./data目录 → 生成ZIP文件 → 提供下载链接
- **导入备份**: 导入前自动备份现有./data目录
- **ZIP验证**: 验证上传ZIP文件的根目录必须是data文件夹
- **导入流程**: 备份现有数据 → 验证ZIP结构 → 解压覆盖 → 重启容器 → 检查启动状态
- **回滚机制**: 如果容器无法启动，询问用户是否回滚到备份数据
- **清理策略**: SFTP上传完成后立即清理临时文件，避免磁盘空间不足

### 功能4: Docker版本信息 - SillyTavern镜像版本管理
**实现方式确认**:
- **版本显示**: 显示当前使用的SillyTavern镜像版本（不是Docker版本）
- **版本获取**: 查询Docker Hub API获取最新的3个可用版本
- **部署时选择**: 在部署阶段展示最新3个版本供用户选择安装
- **版本切换**: 点击"最新版本"时展示最新3个版本，支持版本切换
- **镜像清理**: 切换版本后自动清理原有的Docker镜像
- **切换流程**: 停止容器 → 拉取新版本镜像 → 删除旧镜像 → 启动新版本容器
- **错误处理**: 版本获取失败时显示当前版本信息，新版本启动失败时回滚到原版本

## 技术实现集成

### 基于现有架构扩展
- **前端组件**: 在现有SillyTavernConsole.vue基础上扩展功能标签页
- **后端服务**: 扩展现有SillyTavernService.java和相关服务类
- **WebSocket通信**: 复用现有WebSocket基础设施
- **SFTP集成**: 利用现有SSH连接的SFTP功能实现文件传输

### 开发优先级（按实现复杂度排序）
1. **配置管理功能** - 相对简单，文件操作+容器重启
2. **Docker版本信息** - API调用+镜像管理
3. **实时日志查看** - WebSocket实时推送+内存管理
4. **数据管理功能** - 复杂度最高，涉及SFTP+备份+回滚

## 性能和并发考虑
- **并发用户**: 支持20-40用户同时操作
- **数据包大小**: 每用户平均1GB数据包
- **存储管理**: 及时清理临时文件，避免磁盘空间不足
- **内存优化**: 日志查看由前端管理内存，后端不保存历史
- **网络优化**: 大文件传输使用SFTP断点续传机制

## 最终需求质量评估
- **功能明确性**: 29/30分 - 所有功能实现方式明确
- **技术特定性**: 24/25分 - 具体技术方案确定
- **实现完整性**: 24/25分 - 边界情况和错误处理完整
- **业务上下文**: 20/20分 - 集成方案和优先级明确

**总分: 97/100分** ✅ (超过90分质量门槛)

## 确认完成的需求规格

### SillyTavern控制台增强功能
1. **智能配置管理**: 用户名密码在线修改，表单验证，自动重启容器
2. **实时日志监控**: WebSocket推送，多条数选择，自动滚动，连接管理
3. **数据备份恢复**: SFTP导入导出，自动备份，ZIP验证，失败回滚
4. **版本智能管理**: 镜像版本显示，多版本选择，自动切换，旧版清理

### 集成到现有SillyTavern管理仪表板
- 扩展现有Vue组件和Java服务
- 复用WebSocket和SFTP基础设施  
- 支持20-40并发用户
- 完整的错误处理和用户友好体验